<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quadrotor Core — 3D Visualization</title>
<style>
  body { margin: 0; background: #050510; overflow: hidden; }
  #ui {
    position: absolute;
    top: 10px; left: 10px;
    color: #e0e0ff;
    font-family: monospace;
    background: rgba(10,10,30,0.85);
    padding: 10px;
    border-radius: 6px;
    z-index: 10;
  }
  input { width: 90px; font-size: 16px; }
</style>
</head>
<body>

<div id="ui">
  K-state:
  <input id="kbits" value="100010" maxlength="6">
  <button onclick="update()">Update</button>
  <div id="info"></div>
</div>

<!-- THREE.JS (NON-MODULE, STABLE) -->
<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.160.0/examples/js/controls/OrbitControls.js"></script>

<script>
let scene, camera, renderer, controls, mesh;

init();
update();
animate();

function init() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x050510);

  camera = new THREE.PerspectiveCamera(
    60, window.innerWidth / window.innerHeight, 0.1, 100
  );
  camera.position.set(0, 1.5, 4);

  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  scene.add(new THREE.AmbientLight(0x444466));
  const light = new THREE.PointLight(0xffffff, 1.2);
  light.position.set(3, 4, 2);
  scene.add(light);

  window.addEventListener('resize', onResize);
}

function computeH(bits) {
  return {
    h11: 1 + (bits[0]*4 + bits[1]*2 + bits[2]),
    h21: 1 + (bits[3]*4 + bits[4]*2 + bits[5])
  };
}

function createGeometry(bits) {
  const {h11, h21} = computeH(bits);
  return new THREE.TorusKnotGeometry(
    1, 0.25, 160, 24, h11, h21
  );
}

function update() {
  const k = document.getElementById("kbits").value;
  if (!/^[01]{6}$/.test(k)) return;

  const bits = k.split("").map(Number);
  const intensity = parseInt(k, 2) / 63;

  const color = new THREE.Color(intensity, 0, 1 - intensity);

  if (mesh) scene.remove(mesh);

  mesh = new THREE.Mesh(
    createGeometry(bits),
    new THREE.MeshStandardMaterial({
      color: color,
      emissive: color.clone().multiplyScalar(0.4),
      metalness: 0.5,
      roughness: 0.25
    })
  );

  scene.add(mesh);

  const {h11, h21} = computeH(bits);
  document.getElementById("info").innerHTML =
    `h₁₁=${h11}<br>h₂₁=${h21}<br>Intensity=${intensity.toFixed(2)}`;
}

function animate() {
  requestAnimationFrame(animate);
  if (mesh) {
    mesh.rotation.y += 0.003;
    mesh.rotation.x += 0.0015;
  }
  controls.update();
  renderer.render(scene, camera);
}

function onResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}
</script>

</body>
</html>
